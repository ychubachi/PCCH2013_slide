#+TITLE: クラウドと仮想化技術を用いた \linebreak Web アプリケーション開発演習環境
#+AUTHOR: 産業技術大学院大学 \linebreak *中鉢 欣秀・小山 裕司
#+DATE: 2013-11-03
#+OPTIONS: H:2
#+BEAMER_THEME: Madrid
#+COLUMNS: %45ITEM %10BEAMER_ENV(Env) %10BEAMER_ACT(Act) %4BEAMER_COL(Col) %8BEAMER_OPT(Opt)
#+OPTIONS: ^:nil toc:nil
#+PROPERTY: BEAMER_col_ALL 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 0.0 :ETC

* はじめに
  - OSの仮想化技術とクラウドを活用したWebアプリケーション開発環境
    - Ruby on Railsを用いた開発演習のために使用
  - 仮想OS環境の構築
    - VirtualBox
    - Vagrant
    
- 演習に必要なツールや開発環境，ライブラリを含むOSイメージを作成して受講者に配布

- クラウド技術の利用として，GitHubによるソースコードの共有，Travis CI(4)による継続的統合，Heroku(5)によるアプリケーション・ソフトウエアの公開などの演習を行った．

* 背景
  - プログラミングを伴うソフトウエア開発演習
    - 受講者が用いる開発環境はできるだけ同じものを使うことが望ましい
    - 受講者が持参するノートPCを用いる授業
      - WindowsやMac（OS X）といった異なるOSが混在
      - これらの違いに対応しながら様々なツールや開発環境を学生にインストールさせる
	- 手間のかかる作業
      - 同じツールであってもOSが異なればユーザ・インタフェースに違いがある
そこで，本研究ではOSの仮想化技術を用いて，演習に必要なすべての環境をOSのイメージとしてパッケージにすることで，共通の開発環境を容易に配布できるようにした．
加えて，ソースコードのVCSであるGitHub，継続的インテグレーションのためのTravis CI，アプリケーションをデプロイするHerokuの各クラウドとの連動を自動化するためのスクリプトも合わせて用意した．
以上により，学生は開発環境の設定作業に煩わされることなく，ソフトウエア開発演習に注力できるようになる．

* 提案手法
** 全体構成
本提案手法の中核となるのは，仮想化ツールであるVirtualBoxと，これを制御するためのコマンドライン・インタフェースであるVagrantである．この2つのツールをインストールしておけば，WindowsやOS Xといった環境の差異を意識することなく，仮想環境を利用できるようになる．
仮想環境のOSイメージを作成するためにもこの2つのツールを利用することができる．更に，Vagrantと連携するChef(6)を用いることで，仮想OSへの各種ツールのインストール作業をスクリプトにすることもできる．

** 仮想環境の作成
仮想OSにはLinuxのディストリビューションであるUbuntuを用い，Ruby on Railsによる開発のための各種のツールを予めインストールした．インストールした主なツールは次のとおりである．

rbenv, ruby 2.0.0-p247
git
vim, emacs24
Heroku toolbelt（Heroku用CLI）
hub（GitHub用CLI）

なお，これらを仮想OSに組み込むための設定は次のURLにて公開している．



** 仮想環境の配布
受講者には次のソフトウエアをインストールさせる．

VirtualBox
Vagrant

Windowsの場合は

Windows 版Git(7)

もインストールする．OS Xの場合は標準でインストールされているgitコマンドを用いることができる．
また，次のクラウド・サービスのアカウントも作成しておく．

GitHub
Heroku

なおTravis CIにはGitHubアカウントを用いてログインすることができる．
以上の準備が整ったら，ターミナルから次の通り入力することで開発用の仮想環境が立ち上がる（Windowsの場合はターミナルとしてWindows版Gitに付属する「Git Bash」を使う．日本語を正しく表示させるため，起動後，プロパティからフォントを「ラスター フォント」に変更する）．



途中，vagrant upの際に，仮想OSのイメージをダウンロードするために時間が掛かる．なお，OSのイメージはAmazon S3に置いてある．

** クラウド関連スクリプト
実行中の仮想OS内から次の2つのスクリプトを利用することができる．

1. SSH公開鍵の生成とGitHubのユーザ・プロファイルへ登録する（github-connect.sh）
2. Railsアプリケーションの雛形作成，GitHubリポジトリの作成と登録，Travis CI連携のための設定，および，Herokuへのデプロイをする（generate_rails.sh）

なお1.はGitHubで公開されているものを用いた(8)．2.は仮想OS内のhub，travis，herokuコマンドなどを組み合わせて筆者が作製したものである．
また，このスクリプトを含む全ての設定と簡単なマニュアル（README.md）は次のURLからダウンロード可能である．



* 有用性に関する考察
以上述べた仮想OS環境の初期バージョンを用いたプログラミング演習を2013年9月2日から5日間実施した（1日3コマ連続で合計15コマ）．この授業は本学が参加しているenPiT BizApp分野の一環として，主に修士の学生を対象とした「ビジネスアプリケーション演習」である(9)．参加者は15名であった．また，学生が持参したノートPCは，WindowsとMacがほぼ同数であった．
初日の授業でVirtualBoxとVagrantのインストールや，OSイメージの配布を行った．この際，OSイメージをダウンロードするために予想以上に時間が掛かったため，急遽，USBメモリによる配布に切り替えた．ファイルのサイズは1GB弱であったが，USBメモリでの配布はスムーズに行なわれた．
なお，この授業を実施した時点では，現在のようにOSイメージにhubやtravisコマンドを組み込んでいなかったため，これらのインストールにも時間を要した．ただし，Rubyのコンパイルは事前に行っていたため，その分の時間短縮は達成できた．加えて，GitHubへの公開鍵の登録や，Travis CIとHerokuの連携に関しても，手作業で行った分時間を要した．途中，Gitコマンドの解説や，Railsについても説明が必要だったこともあり，すべての学生が仮想化やクラウドを利用できるようになったのは4日目であった．
ただし，現在はより洗練されたスクリプトがあるので，同様の授業であればより効率よく実施できるものと考える．今後もこの環境を用いた授業を行う予定なので，継続的に評価や改善を行いたい．

* おわりに
本研究では，仮想OS技術を活用することでWebアプリケーションの開発演習を実施するための各種設定やスクリプトの作成を行い，学生が容易に開発環境を導入できるようにすることを試みた．
また，クラウド環境を利用したソースコード共有，継続的な統合，アプリケーションのデプロイといった先端的な開発環境を用いた演習を円滑に実施するための工夫をした．
なお，今回開発したパッケージはすべてGitHubにて公開しているので，ご活用頂ければ幸いである．

